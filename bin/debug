<?php
require 'vendor/autoload.php';
require_once('compilerHelper.php');

use PHPScript\Compiler\Loader;
use PHPScript\DependencyGraphBuilder;
use PHPScript\Transpiler;
use PHPScript\TranspilerDependencyTree;

$loader = new Loader();
$dependencyManager = new DependencyGraphBuilder();

$config = $loader->getConfigFile();
$transpilerDependencyTree = new TranspilerDependencyTree($config);

$listPrograms = $loader->load($config['paths']['source'], $transpilerDependencyTree);
$dependencyManager->buildGraph($listPrograms);

$transpiler = new Transpiler($config, $dependencyManager);

$file = $argv[1];

if (!file_exists($file)) {
    die("File not found: $file\n");
}

$code = file_get_contents($file);

try {
    $result = $transpiler->compile($code, $file);
    echo "\n\033[1;32mâœ” SUCCESSFUL PHP OUTPUT\033[0m\n";
    echo $result . "\n";
} catch (\Exception $e) {
    getErrorInterface($e, $transpiler, $code);
}
